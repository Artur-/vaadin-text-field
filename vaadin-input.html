<!--
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
-->

<!--
`<vaadin-input>` is a Polymer element for <element-functionality>.

```html
<vaadin-input>
</vaadin-input>
```

@element vaadin-input
@demo demo/index.html
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="vaadin-form-element-behavior.html">

<dom-module id="vaadin-input">
  <template>
    <style>
      :host {
        display: inline-block;
      }
      input {
        outline: none;
        border: solid 1px #d8d8d8;
      }
      input:focus {
        border-bottom: solid 1px deepskyblue;
      }
      input:invalid {
        background: #fbefef;
      }
      input:focus:invalid {
        border-bottom: solid 1px red;
      }
    </style>
    <input id="input"
      autocapitalize$="{{autocapitalize}}"
      autocomplete$="{{autocomplete}}"
      autocorrect$="{{autocorrect}}"
      autofocus$="{{autofocus}}"
      disabled$="{{disabled}}"
      list="{{list}}"
      maxlength$="{{maxlength}}"
      minlength$="{{minlength}}"
      name="{{name}}"
      pattern="{{pattern}}"
      placeholder="{{placeholder}}"
      readonly$="{{readonly}}"
      required$="{{required}}"
      tabindex$="{{tabindex}}"
      value="{{value::input}}"
      type$="{{type}}"
      title="{{title}}"
    />
  </template>

  <script>
    class VaadinInput extends window.VaadinFormElementBehavior(Polymer.Element) {
      static get is() {
        return 'vaadin-input';
      }

      static get config() {
        return {
          properties: {
            autocapitalize: {
              type: String,
              notify: true
            },
            autocomplete: {
              type: Boolean,
              notify: true
            },
            autocorrect: {
              type: Boolean,
              notify: true
            },
            autofocus: {
              type: Boolean,
              notify: true
            },
            disabled: {
              type: Boolean,
              notify: true
            },
            list: {
              type: String,
              notify: true
            },
            maxlength: {
              type: Number,
              notify: true
            },
            minlength: {
              type: Number,
              notify: true
            },
            name: {
              type: String,
              notify: true
            },
            pattern: {
              type: String,
              notify: true
            },
            placeholder: {
              type: String,
              notify: true
            },
            readonly: {
              type: Boolean,
              notify: true
            },
            required: {
              type: Boolean,
              notify: true
            },
            title: {
              type: String
            },
            type: {
              type: String,
              default: 'text'
            },
            tabindex: {
              type: Number,
              notify: true
            },
            value: {
              type: String,
              observer: '_valueChanged',
              notify: true
            },
            bindValue: {
              type: String,
              observer: '_bindValueChanged'
            },
            invalid: {
              type: Boolean,
              reflectToAttribute: true
            }
          },

          observers: [
            '_bindValueChanged(bindValue)'
          ]
        };
      }

      ready() {
        super.ready();
        this.bindValue = this.value;
        this.invalid = this._isInvalid();
      }

      _valueChanged(value) {
        this.bindValue = value;
      }

      _bindValueChanged(bindValue) {
        this.value = bindValue;
        this.dispatchEvent(new CustomEvent('bind-value-changed'), {bubbles: true});
        this.invalid = this._isInvalid();
      }

      _isInvalid() {
        return !this.validate();
      }

      /**
       * Returns true if `value` is valid.
       * `<iron-form>` uses this to check the validity or all its elements.
       *
       * @return {boolean} True if the value is valid.
       */
      validate() {
        // Use input's native validity.
        var valid = this.$.input.checkValidity();
        // Only do extra checking if the browser thought this was valid.
        if (valid) {
          // Empty, required input is invalid
          if (this.required && this.bindValue === '') {
            valid = false;
          }
        }
        return valid;
      }
    }

    customElements.define(VaadinInput.is, VaadinInput);
  </script>
</dom-module>
